<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI Data Interface</title>
    <!-- Bootstrap CSS CDN -->
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
        rel="stylesheet" 
        integrity="sha384-MQjYnvV21tAqz5Rr+nQjK8uPLg5Cw+Ri3r6NfU1zFZx6i3+T3Wm3vYbA6r9bbBZ+" 
        crossorigin="anonymous">
</head>
<body>
<div class="container my-5">
    <h1 class="mb-4 text-center">FastAPI Data Interface</h1>

    <!-- SECTION GENERATE DATASET -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header">
            <strong>Générer un Dataset</strong>
        </div>
        <div class="card-body">
            <form id="generateForm">
                <div class="row mb-3">
                    <div class="col">
                        <label for="phase" class="form-label">Phase</label>
                        <select class="form-select" id="phase" required>
                            <option value="clean" selected>clean</option>
                            <option value="eda">eda</option>
                            <option value="mv">mv</option>
                            <option value="ml">ml</option>
                            <option value="ml2">ml2</option>
                        </select>
                    </div>
                    <div class="col">
                        <label for="seed" class="form-label">Seed</label>
                        <input type="number" class="form-control" id="seed" value="42" required>
                    </div>
                    <div class="col">
                        <label for="n" class="form-label">Nombre de lignes</label>
                        <input type="number" class="form-control" id="n" value="500" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Générer Dataset</button>
            </form>
            <hr>
            <pre id="generateResult" class="bg-light p-3" style="max-height:300px; overflow:auto;"></pre>
        </div>
    </div>

    <!-- SECTION CLEAN (exemple pour pipeline de nettoyage) -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header">
            <strong>Pipeline de Nettoyage</strong>
        </div>
        <div class="card-body">
            <form id="cleanForm">
                <div class="row mb-3">
                    <div class="col">
                        <label for="impute_strategy" class="form-label">Imputation</label>
                        <select class="form-select" id="impute_strategy">
                            <option value="mean" selected>mean</option>
                            <option value="median">median</option>
                        </select>
                    </div>
                    <div class="col">
                        <label for="outlier_strategy" class="form-label">Outliers</label>
                        <select class="form-select" id="outlier_strategy">
                            <option value="clip" selected>clip</option>
                            <option value="remove">remove</option>
                        </select>
                    </div>
                    <div class="col">
                        <label for="categorical_strategy" class="form-label">Catégorielle</label>
                        <select class="form-select" id="categorical_strategy">
                            <option value="one_hot" selected>one_hot</option>
                            <option value="ordinal">ordinal</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">Fit Pipeline</button>
            </form>
            <hr>
            <pre id="cleanResult" class="bg-light p-3" style="max-height:300px; overflow:auto;"></pre>
        </div>
    </div>
</div>

<!-- Bootstrap JS CDN -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API_BASE = "http://api:8000"; // Docker: le nom du service API

// ====== Génération Dataset ======
document.getElementById("generateForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const phase = document.getElementById("phase").value;
    const seed = parseInt(document.getElementById("seed").value);
    const n = parseInt(document.getElementById("n").value);

    try {
        const response = await fetch(`${API_BASE}/dataset/generate`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({phase, seed, n})
        });

        if (!response.ok) throw new Error(`Erreur ${response.status}`);
        const data = await response.json();
        document.getElementById("generateResult").textContent = JSON.stringify(data, null, 2);
    } catch (err) {
        document.getElementById("generateResult").textContent = err;
    }
});

// ====== Fit Clean Pipeline ======
document.getElementById("cleanForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const params = {
        impute_strategy: document.getElementById("impute_strategy").value,
        outlier_strategy: document.getElementById("outlier_strategy").value,
        categorical_strategy: document.getElementById("categorical_strategy").value
    };

    try {
        const response = await fetch(`${API_BASE}/clean/fit`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({meta: {dataset_id: "example"}, params})
        });

        if (!response.ok) throw new Error(`Erreur ${response.status}`);
        const data = await response.json();
        document.getElementById("cleanResult").textContent = JSON.stringify(data, null, 2);
    } catch (err) {
        document.getElementById("cleanResult").textContent = err;
    }
});
</script>
</body>
</html>
